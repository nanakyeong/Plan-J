<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Kakao Map with Gradient Route</title>
  <style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        width: 100%;
        height: 100%;
    }
    #map {
        width: 100%;
        height: 100%;
    }
  </style>
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=717bb0e96399df26123f9decca5a9795&libraries=services"></script>
</head>
<body>
<div id="map"></div>
<script>
  var mapContainer = document.getElementById('map');

  function displayRoute(optimizedPaths, markerData, centerLat, centerLng) {
    var mapOption = {
        center: new kakao.maps.LatLng(centerLat, centerLng),
        level: 9
    };
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 항상 교통량 정보 표시
    map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);

    function addMarker(position, title, index) {
        var imageSrc = `https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png`;
        var imageSize = new kakao.maps.Size(36, 37);
        var imgOptions =  {
            spriteSize : new kakao.maps.Size(36, 691),
            spriteOrigin : new kakao.maps.Point(0, (index * 46) + 10),
            offset: new kakao.maps.Point(13, 37)
        };
        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions);

        var marker = new kakao.maps.Marker({
            position: position,
            image: markerImage,
            map: map
        });

        var infowindow = new kakao.maps.InfoWindow({
            content: `<div style="padding:5px;">${title}</div>`
        });
        kakao.maps.event.addListener(marker, 'mouseover', function() {
            infowindow.open(map, marker);
        });
        kakao.maps.event.addListener(marker, 'mouseout', function() {
            infowindow.close();
        });
    }

    try {
        var data = JSON.parse(optimizedPaths);
        var markers = JSON.parse(markerData);
        var linePath = [];

        data.forEach(roads => {
            roads.forEach(road => {
                var vertexes = road.vertexes;
                for (var i = 0; i < vertexes.length; i += 2) {
                    var lat = vertexes[i + 1];
                    var lng = vertexes[i];
                    var latLng = new kakao.maps.LatLng(lat, lng);
                    linePath.push(latLng);
                }
            });
        });

        markers.forEach((marker, index) => {
            var position = new kakao.maps.LatLng(marker.y, marker.x);
            addMarker(position, marker.title, index);
        });

        for (var i = 0; i < linePath.length - 1; i++) {
            var polyline = new kakao.maps.Polyline({
                path: [linePath[i], linePath[i + 1]],
                strokeWeight: 5,
                strokeColor: `hsl(${(i / linePath.length) * 240}, 100%, 50%)`,
                strokeOpacity: 0.8
            });
            polyline.setMap(map);
        }

    } catch (error) {
        console.error("Error displaying route:", error);
    }
  }
</script>

</body>
</html>
